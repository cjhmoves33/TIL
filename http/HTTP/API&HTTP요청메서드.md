# API

## API URI를 설계할 때는 리소스를 식별하는것에 중점을 두어야한다.

- 리소는의 의 의미는?
  - 회원을 등록하고 수정하고 조회하는게 리소스가 아니다.
  - 회원이라는 개념 자체가 리소스다.
- 리소스를 어떻게 식별하는게 좋을까?
  - 회원을 등록하고 수정하고 조회하는 것을 모두 배제
  - 회원이라는 리소스만 식별하면 된다. -> 회원 리소스를 URI에 매핑

```
ex/ 리소스 식별, URI 계층 구조 활용

회원 목록 조회 /members
회원 조회 /members/{id}
회원 등록 /members/{id}
회원 수정 /members/{id}
회원 삭제 /members/{id}

참고: 계층 구조상 상위 컬렉션으로 보고 복수단어 사용 권장(member -> members)
```

- 여기서 목록조회/조회/등록/수정/삭제을 어떻게 구분하는가?
- 리소스와 행위를 분리(가장 중요한 것은 리소스를 식별하는 것)
- URI는 리소스만 식별
- 리소스와 해당 리소스를 대상으로 하는 행위를 분리
  - 리소스: 회원
  - 행위: 조회, 등록, 삭제, 변경
- 리소스는 명사, 행위는 동사
- 행위(메서드)는 어떻게 구분?

# HTTP method

HTTP는 요청 메서드를 정의하며, 주어진 리소스에 수행하길 원하는 행동을 나타낸다. 요청 메서드를 HTTP동사 라고 부르기도한다. 각각의 메서드는 서로 다른 의미를 구현하지만, 일부 기능은 메서드 집합 간에 서로 공유하기도 한다. 이를테면 응답 메서드는 '안전'하거나, '캐시가능'하거나 '멱등성'을 가질 수 있다.

- GET: GET 메서드는 특정 리소스의 표시를 요청합니다. GET을 사용하는 요청은 오직 데이터를 받기만 한다.(리소스 조회)
- POST: POST 메서드는 특정 리소스의 엔티티를 제출할때 쓰인다. 이는 종종 서버의 상태의 변화나 부작용을 일으킨다.(요청 데이터 처리, 주로 등록에 사용)
- PUT: PUT 메서드는 목적 리소스 모든 현재 표시를 요청 payload로 바꾼다.(리소스를 대체, 해당 리소스가 없으면 생성)
- PATCH: PATCH 메서드는 리소스의 부분만을 수정하는 데 쓰인다.(리소스 부분 변경)
- DELETE: DELETE메서드는 특정 리소스를 삭제한다.(리소스 삭제)

- HEAD: HEAD 메서드는 GET 메서드의 요청과 동일한 응답을 요구하지만, 응답 바디를 포함하지 않는다.(GET과 동일하지만 메시지 부분을 제외하고, 상태줄과 헤더만 반환)
- OPTIONS: OPTIONS 메서드는 목적 리소스의 통신을 설정하는데 쓰인다.(주로 CORS에서 사용)
- CONNECT: CONNECT 메서드는 목적 리소스로 식별되는 서버로 터널을 맺는다.

## GET

GET /search?q=hello&hl=ko HTTP/1.1
Host: www.google.com

- 리소스 조회
- 서버에 전달하고 싶은 데이터는 query(쿼리 파라미터, 쿼리 스트링)를 통해서 전달(일반적으로 바디를 안쓴다고 생각하면 된다.↓↓↓↓)
- 메시지 바디를 사용해서 데이터를 전달할 수 있지만, 지원하지 않는 곳이 많아서 권장하지 않음(그냥 안쓴다고 생각하면 됨).

```
클라이언트가 서버로 GET요청
(client)                                                        (server)
GET /members/100 HTTP/1.1                                       { "username": "young", "age": 20}
Host: localhost:8080

서버로 부터 응답 데이터
HTTP /1.1 200 OK
Content-type: application/json
Content-Length: 34

{
  "username": "young,
  "age": 20
}

```

## POST

POST /members HTTP/1.1
Content-Type: application/json

{
"username": "hello",
"age": 20
}

- 요청 데이터 처리
- 메시지 바디를 통해 서버로 요청 데이터 전달
- 서버는 요청 데이터를 처리
  - 메시지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행한다.
- 주로 전달된 데이터로 신규 리소스 등록, 프로세스 처리에 사용.

```
여기서 내부적으로 클라이언트가 "POST /members"라는 요청을 보냈을 때 서버가 어떤 처리를 할지 전부 구현을 해야한다.
지금은 "POST /members"가 서버에 데이터를 등록하는 기능 이라고 가정함

클라이언트가 서버에 POST 요청
(client)                                                      (server)
POST /members HTTP/1.1                                        /members
Content-Type: application/json
{
  "username": "young",
  "age": 20
}

(데이터베이스에 등록 후)신규 리소스 생성
(server)
/members/100
{
  "username": "young",
  "age": 20
}


응답 데이터
HTTP /1.1 201 Created
Content-Type: application/json
Content-Length: 34
Location: /members/100

{
  "username": "young",
  "age": 20
}

POST요청에 대한 서버의 응답데이터를 보면 단지 '성공적으로 수행했다' 가 아니라, 어떤 정보를 어떻게 수행했는지에 대해서도 응답 데이터에 포함시킨다.
```

### POST는 요청 데이터를 어떻게 처리한다는 뜻일까?

- 스펙: POST메서드는 대상 리소스가 리소스의 고유한 의미 체계에 따라 요청에 포함 된 표현을 처리하도록 요청한다.
- 예를 들어 POST는 다음과 같은 기능에 사용된다.
  - HTML 양식에 입력 된 필드와 같은 데이터 블록을 데이터 처리 프로세스에 제공 (예/ HTML FORM에 입력한 정보로 회원가입, 주문 등에 사용)
  - 게시판, 뉴스 그룹, 메일링 리스트, 블로그 또는 유사한 기사 그룹에 데시지 게시(예/ 게시판 글쓰기, 댓글 달기)
  - 서버가 아직 식별하지 않은 새 리소스 생성(예/ 신규 주문 생성)
  - 기존 자원 데이터 추가
- 정리: 이 리소스 URI에 POST 요청이 오면 요청 데이터를 어떻게 처리할지 리소스마다 따로 정해야함.

### POST 정리

1. 새 리소스 생성(등록)

- 서버가 아직 식별하지 않은 새 리소르 생성

2. 요청 데이터 처리(중요!)

- 단순히 데이터를 생성하거나, 변경하는 것을 넘어서 프로세스를 처리해야 하는 경우.
  - 예) 주문에서 결제완료 -> 배달시작 -> 배달완료 처럼 단순히 값 변경을 넘어 프로세스의 상태가 변경되는 경우
- POST의 결과로 새로운 리소스가 생성도지 않을 수도 있음.
  - 예) POST /orders/{orderId}/start-delivery(컨트롤 URI)
  - -> 기본적으로 URI는 명사를 사용해야하지만 그것만으로는 해결할 수 없는 상황이 오기 마련이다. 그럴경우 동사형으로도 사용하기는 함(컨트롤 URI)

3. 다른 메서드로 처리하기 애매한 경우

- 예) JSON으로 조회 데이터를 넘겨야 하는데, GET 메서드를 사용하기 어려운 경우.
- 애매하면 POST

4. GET은 서버에서 데이터를 캐싱하게돼있지만 POST는 그러기 어렵다. 조회의 경우 GET을 최대한 사용해야한다.
